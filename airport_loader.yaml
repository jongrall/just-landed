# Run the bulk upload with:
#
# appcfg.py upload_data --config_file=airport_loader.yaml
# --filename=airports.csv --kind=Airport --application=s~just-landed
# --url=http://just-landed.appspot.com/_ah/remote_api

python_preamble:
- import: base64
- import: re
- import: google.appengine.ext.bulkload.transform
- import: google.appengine.ext.bulkload.bulkloader_wizard
- import: google.appengine.ext.db
- import: google.appengine.api.datastore
- import: google.appengine.api.users
- import: uploadutil

transformers:
- kind: Airport
  connector: csv
  connector_options:
    encoding: utf-8
    columns: from_header
  property_map:
    - property: __key__
      external_name: key
      import_transform: uploadutil.make_key

    - property: iata_code
      external_name: iata_code
      import_transform: transform.none_if_empty(unicode)

    - property: name
      external_name: name
      import_transform: transform.none_if_empty(unicode)

    - property: city
      external_name: city
      import_transform: transform.none_if_empty(unicode)

    - property: country
      external_name: country
      import_transform: transform.none_if_empty(unicode)

    - property: location
      import_template: "%(latitude)s %(longitude)s"
      import_transform: uploadutil.geo_converter

    - property: altitude
      external_name: altitude
      import_transform: transform.none_if_empty(int)

    - property: timezone_offset
      external_name: timezone_offset
      import_transform: transform.none_if_empty(float)

    - property: dst
      external_name: dst
      import_transform: transform.none_if_empty(unicode)